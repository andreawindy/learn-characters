<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>è®¤å­—å°èƒ½æ‰‹</title>
    
    <!-- Error Handler for debugging blank screens -->
    <script>
      window.onerror = function(msg, url, lineNo, columnNo, error) {
        var container = document.getElementById('root');
        if (!container) {
           container = document.createElement('div');
           document.body.appendChild(container);
        }
        container.innerHTML = '<div style="padding:20px; color:red; font-family:sans-serif;"><h3>å¯åŠ¨é”™è¯¯ (App Startup Error)</h3><p>' + msg + '</p><p>Line: ' + lineNo + '</p></div>';
        return false;
      };
    </script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (UMD - More stable for standalone files) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap');
      body {
        font-family: 'Noto Sans SC', sans-serif;
        background-color: #f0f9ff;
        overscroll-behavior-y: none;
        -webkit-tap-highlight-color: transparent;
      }
      .animate-bounce-short { animation: bounce 0.5s ease-in-out 1; }
      @keyframes shake {
        10%, 90% { transform: translate3d(-1px, 0, 0); }
        20%, 80% { transform: translate3d(2px, 0, 0); }
        30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
        40%, 60% { transform: translate3d(4px, 0, 0); }
      }
      @keyframes scoreBump {
        0% { transform: scale(1); }
        50% { transform: scale(1.5); color: #16a34a; text-shadow: 0 0 10px rgba(22, 163, 74, 0.5); }
        100% { transform: scale(1); }
      }
      .animate-score-bump { animation: scoreBump 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
      @keyframes popIn {
        0% { transform: scale(0.5); opacity: 0; }
        60% { transform: scale(1.1); opacity: 1; }
        100% { transform: scale(1); opacity: 1; }
      }
      .animate-pop-in { animation: popIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; }
      @keyframes slowSpin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
      .animate-slow-spin { animation: slowSpin 10s linear infinite; }
      
      /* Custom scrollbar for textareas */
      textarea::-webkit-scrollbar { width: 8px; }
      textarea::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 4px; }
      textarea::-webkit-scrollbar-thumb { background: #c7c7c7; border-radius: 4px; }
      textarea::-webkit-scrollbar-thumb:hover { background: #a8a8a8; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- INLINE ICONS (Replaces Lucide dependency for better offline/single-file stability) ---
        const Icon = ({ path, className, size = 24, fill = "none" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill={fill} 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {path}
            </svg>
        );

        const Icons = {
            Settings: (props) => <Icon {...props} path={<><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></>} />,
            Play: (props) => <Icon {...props} path={<polygon points="5 3 19 12 5 21 5 3" />} />,
            Volume2: (props) => <Icon {...props} path={<><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5" /><path d="M19.07 4.93a10 10 0 0 1 0 14.14" /><path d="M15.54 8.46a5 5 0 0 1 0 7.07" /></>} />,
            Trophy: (props) => <Icon {...props} path={<><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" /><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" /><path d="M4 22h16" /><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" /><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" /><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" /></>} />,
            AlertCircle: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10" /><line x1="12" x2="12" y1="8" y2="12" /><line x1="12" x2="12.01" y1="16" y2="16" /></>} />,
            Flame: (props) => <Icon {...props} path={<path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z" />} />,
            Star: (props) => <Icon {...props} path={<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />} />,
            X: (props) => <Icon {...props} path={<><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></>} />,
            GraduationCap: (props) => <Icon {...props} path={<><path d="M22 10v6M2 10l10-5 10 5-10 5z" /><path d="M6 12v5c3 3 9 3 12 0v-5" /></>} />,
            CheckCircle: (props) => <Icon {...props} path={<><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></>} />,
            Download: (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" x2="12" y1="15" y2="3" /></>} />,
            Upload: (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="17 8 12 3 7 8" /><line x1="12" x2="12" y1="3" y2="15" /></>} />,
            Save: (props) => <Icon {...props} path={<><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" /><polyline points="17 21 17 13 7 13 7 21" /><polyline points="7 3 7 8 15 8" /></>} />,
        };

        const { useState, useEffect, useCallback, useRef } = React;

        // --- CONSTANTS ---
        const DEFAULT_DATA = `å¤©ï¼šå¤©ç©º
åœ°ï¼šåœŸåœ°
äººï¼šäººä»¬
ä½ ï¼šä½ å¥½
æˆ‘ï¼šæˆ‘ä»¬
ä»–ï¼šä»–ä»¬
ä¸€ï¼šä¸€ä¸ª
äºŒï¼šäºŒå
ä¸‰ï¼šä¸‰å¤©
å››ï¼šå››ä¸ª
äº”ï¼šäº”å²
ä¸Šï¼šä¸Šé¢
ä¸‹ï¼šä¸‹é¢
å£ï¼šå£æ°´
è€³ï¼šè€³æœµ
ç›®ï¼šç›®å…‰
æ‰‹ï¼šæ‰‹å¿ƒ
è¶³ï¼šè¶³çƒ
ç«™ï¼šç«™ç«‹
åï¼šåä¸‹
æ—¥ï¼šæ—¥å­
æœˆï¼šæœˆäº®
æ°´ï¼šæ°´æœ
ç«ï¼šç«è‹—
å±±ï¼šå±±é¡¶
çŸ³ï¼šçŸ³å¤´
ç”°ï¼šç”°åœ°
ç¦¾ï¼šç¦¾è‹—
å¯¹ï¼šå¯¹é¢
äº‘ï¼šç™½äº‘
é›¨ï¼šä¸‹é›¨
é£ï¼šå¤§é£
èŠ±ï¼šèŠ±æœµ
é¸Ÿï¼šå°é¸Ÿ
è™«ï¼šè™«å­
å…­ï¼šå…­å²
ä¸ƒï¼šä¸ƒå¤©
å…«ï¼šå…«ä¸ª
ä¹ï¼šä¹ç‚¹
åï¼šååˆ†
çˆ¸ï¼šçˆ¸çˆ¸
å¦ˆï¼šå¦ˆå¦ˆ
é©¬ï¼šé©¬è·¯
åœŸï¼šåœŸåœ°
ä¸ï¼šä¸è¦
ç”»ï¼šç”»ç”»
æ‰“ï¼šæ‰“çƒ
æ£‹ï¼šä¸‹æ£‹
é¸¡ï¼šå°é¸¡
å­—ï¼šæ±‰å­—
è¯ï¼šè¯è¯­
è¯­ï¼šè¯­è¨€
å¥ï¼šå¥å­
å­ï¼šå­©å­
æ¡Œï¼šæ¡Œå­
çº¸ï¼šçº¸å¼ 
æ–‡ï¼šè¯­æ–‡
æ•°ï¼šæ•°å­¦
å­¦ï¼šå­¦ä¹ 
éŸ³ï¼šéŸ³ä¹
ä¹ï¼šå¿«ä¹
å¦¹ï¼šå¦¹å¦¹
å¥¶ï¼šå¥¶å¥¶
å°ï¼šå°å­¦
æ¡¥ï¼šå°æ¡¥
å°ï¼šå¹³å°
é›ªï¼šä¸‹é›ª
å„¿ï¼šå„¿ç«¥
ç™½ï¼šç™½è‰²
è‰ï¼šè‰åœ°
å®¶ï¼šå®¶åº­
æ˜¯ï¼šæ˜¯çš„
è½¦ï¼šæ±½è½¦
è·¯ï¼šé©¬è·¯
ç¯ï¼šè·¯ç¯
èµ°ï¼šèµ°è·¯
ç§‹ï¼šç§‹å¤©
æ°”ï¼šå¤©æ°”
äº†ï¼šå¥½äº†
æ ‘ï¼šå¤§æ ‘
å¶ï¼šæ ‘å¶
ç‰‡ï¼šå¶ç‰‡
å¤§ï¼šå¤§å®¶
é£ï¼šé£ç¿”
ä¼šï¼šä¼šè¯´
ä¸ªï¼šä¸ªå­
çš„ï¼šå¥½çš„
èˆ¹ï¼šå°èˆ¹
ä¸¤ï¼šä¸¤ä¸ª
å¤´ï¼šå¤´å‘
åœ¨ï¼šåœ¨å®¶
é‡Œï¼šé‡Œé¢
çœ‹ï¼šçœ‹è§
è§ï¼šè§é¢
é—ªï¼šé—ªå…‰
æ˜Ÿï¼šæ˜Ÿæ˜Ÿ
æ±Ÿï¼šæ±Ÿæ°´
å—ï¼šæ±Ÿå—
å¯ï¼šå¯ä»¥
é‡‡ï¼šé‡‡èŠ±
è²ï¼šè²èŠ±
é±¼ï¼šå°é±¼
ä¸œï¼šä¸œæ–¹
è¥¿ï¼šè¥¿è¾¹
åŒ—ï¼šåŒ—æ–¹
å°–ï¼šå°–è§’
è¯´ï¼šè¯´è¯
æ˜¥ï¼šæ˜¥å¤©
é’ï¼šé’è‰
è›™ï¼šé’è›™
å¤ï¼šå¤å¤©
å¼¯ï¼šå¼¯è…°
çš®ï¼šçš®çƒ
åœ°ï¼šåœ°é¢
å†¬ï¼šå†¬å¤©
ç”·ï¼šç”·å­©
å¥³ï¼šå¥³å­©
å¼€ï¼šå¼€é—¨
å…³ï¼šå…³é—¨
æ­£ï¼šæ­£åœ¨
åï¼šåé¢
è¿œï¼šè¿œæ–¹
æœ‰ï¼šæœ‰çš„
è‰²ï¼šé¢œè‰²
è¿‘ï¼šé™„è¿‘
å¬ï¼šå¬è§
æ— ï¼šæ— å£°
å£°ï¼šå£°éŸ³
å»ï¼šå‡ºå»
è¿˜ï¼šå›æ¥
æ¥ï¼šæ¥åˆ°
å¤šï¼šå¤šå°‘
å°‘ï¼šå°‘é‡
é»„ï¼šé»„è‰²
ç‰›ï¼šé»„ç‰›
åªï¼šä¸€åª
çŒ«ï¼šå°çŒ«
è¾¹ï¼šæ—è¾¹
é¸­ï¼šé¸­å­
è‹¹ï¼šè‹¹æœ
æœï¼šæ°´æœ
æï¼šæå­
æ¡ƒï¼šæ¡ƒå­
ä¹¦ï¼šä¹¦æœ¬
åŒ…ï¼šä¹¦åŒ…
å°ºï¼šå°ºå­
ä½œï¼šä½œä¸š
ä¸šï¼šä½œä¸š
æœ¬ï¼šæœ¬å­
ç¬”ï¼šé“…ç¬”
åˆ€ï¼šå°åˆ€
è¯¾ï¼šä¸Šè¯¾
æ—©ï¼šæ—©ä¸Š
æ ¡ï¼šå­¦æ ¡
æ˜ï¼šæ˜å¤©
åŠ›ï¼šåŠ›é‡
å°˜ï¼šç°å°˜
ä»ï¼šä»å‰
ä¼—ï¼šå¤§ä¼—
åŒï¼šåŒæ‰‹
æœ¨ï¼šæœ¨å¤´
æ—ï¼šæ ‘æ—
æ£®ï¼šæ£®æ—
æ¡ï¼šä¸€æ¡
å¿ƒï¼šå¼€å¿ƒ
å‡ï¼šå‡èµ·
å›½ï¼šå›½å®¶
æ——ï¼šå›½æ——
ä¸­ï¼šä¸­å›½
çº¢ï¼šçº¢è‰²
æ­Œï¼šæ­Œæ›²
èµ·ï¼šèµ·æ¥
ä¹ˆï¼šä»€ä¹ˆ
ç¾ï¼šç¾ä¸½
ä¸½ï¼šç¾ä¸½
ç«‹ï¼šç«™ç«‹
åˆï¼šä¸­åˆ
æ™šï¼šæ™šä¸Š
æ˜¨ï¼šæ˜¨å¤©
ä»Šï¼šä»Šå¤©
å¹´ï¼šä»Šå¹´
å½±ï¼šå½±å­
å‰ï¼šå‰é¢
åï¼šåé¢
é»‘ï¼šé»‘è‰²
ç‹—ï¼šå°ç‹—
å·¦ï¼šå·¦è¾¹
å³ï¼šå³è¾¹
å®ƒï¼šå®ƒä»¬
å¥½ï¼šå¥½çœ‹
æœ‹ï¼šæœ‹å‹
å‹ï¼šæœ‹å‹
æ¯”ï¼šæ¯”è¾ƒ
å°¾ï¼šå°¾å·´
è°ï¼šè°çš„
é•¿ï¼šé•¿çŸ­
çŸ­ï¼šé•¿çŸ­
æŠŠï¼šæŠŠæ‰‹
ä¼ï¼šé›¨ä¼
å…”ï¼šå…”å­
æœ€ï¼šæœ€å¥½
å…¬ï¼šå…¬å›­
å†™ï¼šå†™å­—
è¯—ï¼šè¯—æ­Œ
ç‚¹ï¼šç‚¹å¤´
è¦ï¼šéœ€è¦
è¿‡ï¼šè¿‡å»
ç»™ï¼šç»™ä½ 
å½“ï¼šå½“æ—¶
ä¸²ï¼šä¸€ä¸²
ä»¬ï¼šæˆ‘ä»¬
ä»¥ï¼šä»¥å
æˆï¼šæˆåŠŸ
æ•°ï¼šæ•°å­—
å½©ï¼šå½©è‰²
åŠï¼šä¸€åŠ
ç©ºï¼šå¤©ç©º
é—®ï¼šé—®é¢˜
åˆ°ï¼šæ¥åˆ°
æ–¹ï¼šæ–¹å‘
æ²¡ï¼šæ²¡æœ‰
æ›´ï¼šæ›´åŠ 
ç»¿ï¼šç»¿è‰²
å‡ºï¼šå‡ºå»
é•¿ï¼šæˆé•¿
ç¡ï¼šç¡è§‰
é‚£ï¼šé‚£é‡Œ
æµ·ï¼šå¤§æµ·
çœŸï¼šçœŸçš„
è€ï¼šè€å¸ˆ
å¸ˆï¼šè€å¸ˆ
å—ï¼šå¥½å—
åŒï¼šåŒå­¦
ä»€ï¼šä»€ä¹ˆ
æ‰ï¼šæ‰èƒ½
äº®ï¼šæ˜äº®
æ—¶ï¼šæ—¶å€™
å€™ï¼šæ—¶å€™
è§‰ï¼šæ„Ÿè§‰
å¾—ï¼šè§‰å¾—
è‡ªï¼šè‡ªå·±
å·±ï¼šè‡ªå·±
å¾ˆï¼šå¾ˆå¥½
ç©¿ï¼šç©¿è¡£
è¡£ï¼šè¡£æœ
æœï¼šè¡£æœ
é—¨ï¼šå¤§é—¨
å¿«ï¼šå¿«ä¹
è“ï¼šè“è‰²
åˆï¼šåˆæ¥
ç¬‘ï¼šç¬‘ç€
ç€ï¼šç¬‘ç€
å‘ï¼šæ–¹å‘
å’Œï¼šå’Œå¹³
è´ï¼šå®è´
å¨ƒï¼šå¨ƒå¨ƒ
æŒ‚ï¼šæŒ‚èµ·
æ´»ï¼šç”Ÿæ´»
é‡‘ï¼šé‡‘è‰²
å“¥ï¼šå“¥å“¥
å§ï¼šå§å§
å¼Ÿï¼šå¼Ÿå¼Ÿ
å”ï¼šå”å”
çˆ·ï¼šçˆ·çˆ·
ç¾¤ï¼šä¸€ç¾¤
ç«¹ï¼šç«¹å­
ç‰™ï¼šç‰™é½¿
ç”¨ï¼šä½¿ç”¨
å‡ ï¼šå‡ æ­¥
æ­¥ï¼šå‡ æ­¥
ä¸ºï¼šä¸ºäº†
å‚ï¼šå‚åŠ 
åŠ ï¼šå‚åŠ 
æ´ï¼šå±±æ´
ç€ï¼šçœ‹ç€
ä¹Œï¼šä¹Œé¸¦
é¸¦ï¼šä¹Œé¸¦
å¤„ï¼šåˆ°å¤„
æ‰¾ï¼šå¯»æ‰¾
åŠï¼šåŠæ³•
æ—ï¼šæ—è¾¹
è®¸ï¼šä¹Ÿè®¸
æ³•ï¼šæ–¹æ³•
æ”¾ï¼šæ”¾è¿›
è¿›ï¼šè¿›å»
é«˜ï¼šé«˜å…´
ä½ï¼šä½æˆ¿
å­©ï¼šå­©å­
ç©ï¼šç©è€
å§ï¼šèµ°å§
å‘ï¼šå‘èŠ½
èŠ½ï¼šå‘èŠ½
çˆ¬ï¼šçˆ¬å±±
å‘€ï¼šå“å‘€
ä¹…ï¼šå¾ˆä¹…
å›ï¼šå›æ¥
å…¨ï¼šå…¨éƒ¨
å˜ï¼šå˜åŒ–
å·¥ï¼šå·¥å‚
å‚ï¼šå·¥å‚
åŒ»ï¼šåŒ»é™¢
é™¢ï¼šåŒ»é™¢
ç”Ÿï¼šå­¦ç”Ÿ
éœœï¼šç™½éœœ
å¹ï¼šå¹é£
è½ï¼šè½ä¸‹
é™ï¼šé™è½
é£˜ï¼šé£˜é›ª
æ¸¸ï¼šæ¸¸æ³³
æ± ï¼šæ± å¡˜
å…¥ï¼šè¿›å…¥
å§“ï¼šå§“æ°
æï¼šæå­
å¼ ï¼šå¼ å¼€
å¤ï¼šå¤ä»£
å´ï¼šå´å›½
èµµï¼šèµµå›½
é’±ï¼šé‡‘é’±
å­™ï¼šå­™å­
å‘¨ï¼šå‘¨å›´
ç‹ï¼šå›½ç‹
å®˜ï¼šå®˜å‘˜
æ¸…ï¼šæ¸…æ°´
æ™´ï¼šæ™´å¤©
çœ¼ï¼šçœ¼ç›
ç›ï¼šçœ¼ç›
ä¿ï¼šä¿æŠ¤
æŠ¤ï¼šä¿æŠ¤
å®³ï¼šå®³æ€•
äº‹ï¼šäº‹æƒ…
è¯·ï¼šè¯·è®©
è®©ï¼šè¯·è®©
ç—…ï¼šç”Ÿç—…
ç›¸ï¼šç›¸é‡
é‡ï¼šç›¸é‡
å–œï¼šå–œæ¬¢
æ¬¢ï¼šå–œæ¬¢
æ€•ï¼šå®³æ€•
è¨€ï¼šè¯­è¨€
äº’ï¼šäº’ç›¸
ä»¤ï¼šå‘½ä»¤
åŠ¨ï¼šåŠ¨ä½œ
ä¸‡ï¼šä¸‡ç‰©
çº¯ï¼šçº¯å‡€
å‡€ï¼šçº¯å‡€
é˜´ï¼šé˜´å¤©
é›·ï¼šé›·å£°
ç”µï¼šé—ªç”µ
é˜µï¼šä¸€é˜µ
å†°ï¼šå†°å†»
å†»ï¼šå†°å†»
å¤¹ï¼šå¤¹ä½
åƒï¼šåƒé¥­
å¿˜ï¼šå¿˜è®°
äº•ï¼šæ°´äº•
æ‘ï¼šä¹¡æ‘
å«ï¼šå«å£°
æ¯›ï¼šæ¯›è±†
ä¸»ï¼šä¸»å¸­
å¸­ï¼šä¸»å¸­
ä¹¡ï¼šä¹¡äº²
äº²ï¼šä¹¡äº²
æˆ˜ï¼šæˆ˜å£«
å£«ï¼šæˆ˜å£«
é¢ï¼šé¢å‰
æƒ³ï¼šæƒ³å¿µ
å‘Šï¼šå‘Šè¯‰
è¯‰ï¼šå‘Šè¯‰
å°±ï¼šå°±æ˜¯
äº¬ï¼šåŒ—äº¬
å®‰ï¼šå®‰å…¨
å¹¿ï¼šå¹¿å·
éï¼šéå¸¸
å¸¸ï¼šéå¸¸
å£®ï¼šå£®è§‚
è§‚ï¼šå£®è§‚
æ¥ï¼šæ¥ç€
å†ï¼šå†åš
åšï¼šåšäº‹
å„ï¼šå„ç§
ç§ï¼šå„ç§
æ ·ï¼šæ ·å­
ä¼™ï¼šä¼™ä¼´
ä¼´ï¼šä¼™ä¼´
å´ï¼šå´ä¹Ÿ
ä¹Ÿï¼šä¹Ÿæ˜¯
è¶£ï¼šæœ‰è¶£
è¿™ï¼šè¿™é‡Œ
å¤ªï¼šå¤ªé˜³
é˜³ï¼šå¤ªé˜³
é“ï¼šé“è·¯
é€ï¼šé€ç»™
å¿™ï¼šå¸®å¿™
å°ï¼šå°è¯•
é¦™ï¼šé¦™ç”œ
ç”œï¼šé¦™ç”œ
æ¸©ï¼šæ¸©æš–
æš–ï¼šæ¸©æš–
è¯¥ï¼šåº”è¯¥
é¢œï¼šé¢œè‰²
å› ï¼šå› ä¸º
è¾†ï¼šè½¦è¾†
åŒ¹ï¼šé©¬åŒ¹
å†Œï¼šä¹¦å†Œ
æ”¯ï¼šæ”¯ç¬”
é“…ï¼šé“…ç¬”
æ£µï¼šä¸€æ£µ
æ¶ï¼šä¹¦æ¶
å—ï¼šä¸€å—
æ‰ï¼šæ‰è™«
æ€¥ï¼šç€æ€¥
ç›´ï¼šä¸€ç›´
æ²³ï¼šæ²³æ°´
è¡Œï¼šè¡Œèµ°
ä¿¡ï¼šä¹¦ä¿¡
è·Ÿï¼šè·Ÿç€
å¿½ï¼šå¿½ç„¶
å–Šï¼šå–Šå«
èº«ï¼šèº«ä½“
çªï¼šçŒªçª
å­¤ï¼šå­¤å•
å•ï¼šå­¤å•
éƒ½ï¼šéƒ½æ˜¯
é‚»ï¼šé‚»å±…
å±…ï¼šé‚»å±…
æ‹›ï¼šæ‹›å‘¼
å‘¼ï¼šæ‹›å‘¼
é™ï¼šå®‰é™
æ€ï¼šæ€ä¹ˆ
ç‹¬ï¼šç‹¬è‡ª
è·³ï¼šè·³ç»³
ç»³ï¼šè·³ç»³
è®²ï¼šè®²æ•…äº‹
ç¾½ï¼šç¾½æ¯›
çƒï¼šç¾½çƒ
æˆï¼šæ¸¸æˆ
æ’ï¼šæ’çƒ
ç¯®ï¼šç¯®çƒ
è¿ï¼šè¿å¿™
è¿ï¼šè¿åŠ¨
å¤œï¼šå¤œæ™š
æ€ï¼šæ€å¿µ
åºŠï¼šåºŠä¸Š
å…‰ï¼šæœˆå…‰
ç–‘ï¼šæ€€ç–‘
ä¸¾ï¼šä¸¾æ‰‹
æœ›ï¼šå¸Œæœ›
ä½ï¼šä½å¤´
æ•…ï¼šæ•…ä¹¡
èƒ†ï¼šèƒ†å­
æ•¢ï¼šå‹‡æ•¢
å¾€ï¼šå¾€å¤–èµ°
å¤–ï¼šå¤–é¢
å‹‡ï¼šå‹‡æ•¢
çª—ï¼šçª—æˆ·
ä¹±ï¼šä¹±è·‘
åï¼šåå
æ•£ï¼šæ•£æ­¥
åŸï¼šåŸæ¥
åƒï¼šå¥½åƒ
å¾®ï¼šå¾®ç¬‘
ç«¯ï¼šç«¯æ­£
ç²½ï¼šç²½å­
èŠ‚ï¼šèŠ‚æ—¥
æ€»ï¼šæ€»æ˜¯
ç±³ï¼šå¤§ç±³
é—´ï¼šä¸­é—´
åˆ†ï¼šåˆ†é’Ÿ
è±†ï¼šè±†å­
è‚‰ï¼šè‚‰ç±»
å¸¦ï¼šå¸¦æ¥
çŸ¥ï¼šçŸ¥é“
æ®ï¼šæ ¹æ®
å¿µï¼šæƒ³å¿µ
è™¹ï¼šå½©è™¹
åº§ï¼šä¸€åº§
æµ‡ï¼šæµ‡æ°´
æï¼šææ°´
æ´’ï¼šæ´’æ°´
æŒ‘ï¼šæŒ‘é€‰
å…´ï¼šé«˜å…´
é•œï¼šé•œå­
æ‹¿ï¼šæ‹¿èµ°
ç…§ï¼šç…§é¡¾
åƒï¼šåƒä¸‡
è£™ï¼šè£™å­
çœ‰ï¼šçœ‰æ¯›
é¼»ï¼šé¼»å­
å˜´ï¼šå˜´å·´
è„–ï¼šè„–å­
è‡‚ï¼šæ‰‹è‡‚
è‚šï¼šè‚šå­
è…¿ï¼šè…¿è„š
è„šï¼šè„šæ­¥
èœ»ï¼šèœ»èœ“
èœ“ï¼šèœ»èœ“
è¿·ï¼šè¿·è·¯
è—ï¼šè—èµ·æ¥
é€ ï¼šåˆ¶é€ 
èš‚ï¼šèš‚èš
èšï¼šèš‚èš
é£Ÿï¼šé£Ÿç²®
ç²®ï¼šé£Ÿç²®
è››ï¼šèœ˜è››
ç½‘ï¼šèœ˜è››ç½‘
åœ†ï¼šåœ†å½¢
ä¸¥ï¼šä¸¥å¯’
å¯’ï¼šä¸¥å¯’
é…·ï¼šé…·æš‘
æš‘ï¼šé…·æš‘
å‡‰ï¼šå‡‰çˆ½
æ™¨ï¼šæ—©æ™¨
ç»†ï¼šç»†é›¨
æœï¼šæœéœ
éœï¼šæœéœ
å¤•ï¼šå¤•é˜³
æ¨ï¼šæ¨æ ‘
æ“ï¼šæ“åœº
åœºï¼šæ“åœº
æ‹”ï¼šæ‹”æ²³
æ‹ï¼šæ‹çƒ
è·‘ï¼šè·‘æ­¥
è¸¢ï¼šè¸¢çƒ
é“ƒï¼šé“ƒå£°
çƒ­ï¼šçƒ­é—¹
é—¹ï¼šçƒ­é—¹
é”»ï¼šé”»ç‚¼
ç‚¼ï¼šé”»ç‚¼
ä½“ï¼šèº«ä½“
ä¹‹ï¼šä¹‹åˆ
åˆï¼šä¹‹åˆ
æ€§ï¼šæ€§å–„
å–„ï¼šæ€§å–„
ä¹ ï¼šå­¦ä¹ 
æ•™ï¼šæ•™å®¤
è¿ï¼šè¿ç§»
è´µï¼šè´µé‡
ä¸“ï¼šä¸“å¿ƒ
å¹¼ï¼šå¹¼å°
ç‰ï¼šç‰å™¨
å™¨ï¼šç‰å™¨
ä¹‰ï¼šä¹‰æ°”
é¥­ï¼šåƒé¥­
èƒ½ï¼šèƒ½åŠ›
é¥±ï¼šåƒé¥±
èŒ¶ï¼šæ³¡èŒ¶
æ³¡ï¼šæ³¡èŒ¶
è½»ï¼šè½»å£°
é­ï¼šé­ç‚®
ç‚®ï¼šé­ç‚®
é¦–ï¼šé¦–å…ˆ
è¸ªï¼šè¸ªè¿¹
è¿¹ï¼šè¸ªè¿¹
æµ®ï¼šæµ®è
èï¼šæµ®è
æ³‰ï¼šæ³‰æ°´
æµï¼šæµæ°´
çˆ±ï¼šçˆ±å¿ƒ
æŸ”ï¼šæŸ”è½¯
è·ï¼šè·èŠ±
éœ²ï¼šéœ²ç 
ç ï¼šéœ²ç 
æ‘‡ï¼šæ‘‡åŠ¨
èººï¼šèººä¸‹
æ™¶ï¼šæ™¶äº®
åœï¼šåœæœº
æœºï¼šåœæœº
å±•ï¼šå±•å¼€
é€ï¼šé€æ˜
ç¿…ï¼šç¿…è†€
è†€ï¼šç¿…è†€
å”±ï¼šå”±æ­Œ
æœµï¼šèŠ±æœµ
è…°ï¼šå¼¯è…°
å¡ï¼šå±±å¡
æ²‰ï¼šæ²‰é‡
ä¼¸ï¼šä¼¸æ‰‹
æ½®ï¼šæ½®æ¹¿
æ¹¿ï¼šæ½®æ¹¿
å‘¢ï¼šåœ¨å‘¢
ç©ºï¼šç©ºæ°”
é—·ï¼šé—·çƒ­
æ¶ˆï¼šæ¶ˆæ¯
æ¯ï¼šæ¶ˆæ¯
æ¬ï¼šæ¬å®¶
å“ï¼šå“å£°
æ£ï¼šæœ¨æ£
æ±¤ï¼šçƒ­æ±¤
æ‰‡ï¼šæ‰‡å­
æ¤…ï¼šæ¤…å­
è¤ï¼šè¤ç«
ç‰µï¼šç‰µç‰›
ç»‡ï¼šç»‡å¸ƒ
æ–—ï¼šæ–—ç¯·
å…·ï¼šå·¥å…·
æ¬¡ï¼šä¸€æ¬¡
ä¸¢ï¼šä¸¢å¤±
å“ªï¼šå“ªé‡Œ
æ–°ï¼šæ–°çš„
æ¯ï¼šæ¯å¤©
å¹³ï¼šå¹³å®‰
å¥¹ï¼šå¥¹ä»¬
äº›ï¼šä¸€äº›
ä»”ï¼šä»”ç»†
æ£€ï¼šæ£€æŸ¥
æŸ¥ï¼šæ£€æŸ¥
æ‰€ï¼šæ‰€ä»¥
é’Ÿï¼šæ—¶é’Ÿ
ä¸ï¼šä¸ç‚¹
å…ƒï¼šå…ƒæ—¦
è¿Ÿï¼šè¿Ÿåˆ°
æ´—ï¼šæ´—æ‰‹
èƒŒï¼šèƒŒåŒ…
åˆšï¼šåˆšåˆš
å…±ï¼šå…±åŒ
æ±½ï¼šæ±½è½¦
å†³ï¼šå†³å®š
å®šï¼šå†³å®š
å·²ï¼šå·²ç»
ç»ï¼šå·²ç»
ç‰©ï¼šåŠ¨ç‰©
è™ï¼šè€è™
ç†Šï¼šé»‘ç†Š
é€šï¼šé€šè¿‡
æ³¨ï¼šæ³¨æ„
æ„ï¼šæ³¨æ„
éï¼šä¸€é
ç™¾ï¼šä¸€ç™¾å—
èˆŒï¼šèˆŒå¤´
é¬¼ï¼šå¦–é­”é¬¼æ€ª
è„¸ï¼šæ´—è„¸
å‡†ï¼šå‡†å¤‡
ç¬¬ï¼šç¬¬ä¸€
çŒ´ï¼šçŒ´å­
ç»“ï¼šç»“æœ
æ°ï¼šæ°å¼€
æ‰›ï¼šæ‰›ç€
æ»¡ï¼šæ»¡åœ°
æ‰”ï¼šæ‰”æ‰
æ‘˜ï¼šæ‘˜æ¢¨å­
æ§ï¼šæ§ç€
ç“œï¼šè¥¿ç“œ
æŠ±ï¼šæŠ±ç€
è¹¦ï¼šè¹¦è·³
è¿½ï¼šè¿½èµ¶
åµï¼šåµé—¹
èƒ–ï¼šèƒ–å­
å²ï¼šå²æœˆ
ç°ï¼šç°åœ¨
ç¥¨ï¼šè½¦ç¥¨
äº¤ï¼šäº¤ç»™
å¼“ï¼šå¼“ç®­
ç”˜ï¼šç”˜ç”œ
æ£‰ï¼šæ£‰èŠ±
å¨˜ï¼šå§‘å¨˜
æ²»ï¼šæ²»ç–—
ç‡•ï¼šç‡•å­
åˆ«ï¼šå‘Šåˆ«
å¹²ï¼šå¹²å‡€
ç„¶ï¼šç„¶å
å¥‡ï¼šå¥‡æ€ª
é¢—ï¼šä¸€é¢—
ç“¢ï¼šæ°´ç“¢
ç¢§ï¼šç¢§ç»¿
åï¼šåæ°”
å•¦ï¼šå¥½å•¦
ç†Ÿï¼šæˆç†Ÿ
æ‰ï¼šæ‰è½
å“ï¼šå“äºº
ç¾Šï¼šå±±ç¾Š
é¹¿ï¼šæ¢…èŠ±é¹¿
é€ƒï¼šé€ƒè·‘
è±¡ï¼šå¤§è±¡
é‡ï¼šé‡å¤–
æ‹¦ï¼šæ‹¦ä½
é¢†ï¼šé¢†å£
å£ï¼šå¢™å£
å¢™ï¼šå¢™å£
èšŠï¼šèšŠå­
å’¬ï¼šå’¬ä¸€å£
æ–­ï¼šæ–­å¼€
æ‚¨ï¼šæ‚¨å¥½
ç”©ï¼šç”©å¼€
èµ¶ï¼šèµ¶èµ°
æˆ¿ï¼šæˆ¿å­
å‚»ï¼šå‚»ç¬‘
è½¬ï¼šè½¬èº«
å«ï¼šå«ç”Ÿ
åˆ·ï¼šåˆ·ç‰™
æ¢³ï¼šæ¢³å¤´
å·¾ï¼šæ¯›å·¾
æ“¦ï¼šæ“¦æ‰‹
çš‚ï¼šè‚¥çš‚
æ¾¡ï¼šæ´—æ¾¡
ç›†ï¼šæ¾¡ç›†
å¡˜ï¼šæ± å¡˜
è„‘ï¼šè„‘è¢‹
è¢‹ï¼šè„‘è¢‹
ç°ï¼šç°å°˜
å“‡ï¼šå“‡å“¦
æ•ï¼šæ•æ‰
è¿ï¼šæ¬¢è¿
é˜¿ï¼šé˜¿å§¨
å§¨ï¼šé˜¿å§¨
é…’ï¼šé»„é…’
ç³–ï¼šç³–æœ
ç›ï¼šé£Ÿç›
é†‹ï¼šé£Ÿé†‹
æ²¹ï¼šé£Ÿæ²¹
é¦™ï¼šé¦™å‘³
è…ï¼šè±†è…
èšï¼šèšæ²¹
é…±ï¼šé…±æ²¹
èƒ¡ï¼šèƒ¡æ¤’
æ¤’ï¼šèƒ¡æ¤’
ç²‰ï¼šç²‰æœ«
è§’ï¼šå…«è§’
çƒ§ï¼šçƒ§çƒ¤
çƒ¤ï¼šçƒ§çƒ¤
æ·€ï¼šæ·€ç²‰`;

        const PRAISE_PHRASES = [
            "ä½ çœŸæ£’ï¼",
            "å¤ªå‰å®³äº†ï¼",
            "å¥½èªæ˜ï¼",
            "å®Œå…¨æ­£ç¡®ï¼"
        ];

        // --- SERVICES ---
        let audioCtx = null;
        const getContext = () => {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioCtx;
        };

        const playCorrectSound = () => {
            try {
                const ctx = getContext();
                if (ctx.state === 'suspended') ctx.resume();
                const now = ctx.currentTime;
                [1046.50, 1318.51, 1568.00].forEach((freq, i) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    const startTime = now + (i * 0.05);
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.type = 'triangle';
                    osc.frequency.value = freq;
                    gain.gain.setValueAtTime(0, startTime);
                    gain.gain.linearRampToValueAtTime(0.15, startTime + 0.02);
                    gain.gain.exponentialRampToValueAtTime(0.001, startTime + 0.4);
                    osc.start(startTime);
                    osc.stop(startTime + 0.4);
                });
            } catch (e) { console.error("Audio error", e); }
        };

        const playCelebrationSound = () => {
            try {
                const ctx = getContext();
                if (ctx.state === 'suspended') ctx.resume();
                const notes = [{f:523.25,d:0.15},{f:659.25,d:0.15},{f:783.99,d:0.15},{f:1046.50,d:0.8}];
                let st = ctx.currentTime;
                notes.forEach((n, i) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.type = i === notes.length-1 ? 'sine':'triangle';
                    osc.frequency.value = n.f;
                    gain.gain.setValueAtTime(0, st);
                    gain.gain.linearRampToValueAtTime(0.2, st + 0.05);
                    gain.gain.exponentialRampToValueAtTime(0.01, st + n.d);
                    osc.start(st);
                    osc.stop(st + n.d);
                    st += 0.12;
                });
            } catch (e) { console.error("Celeb error", e); }
        };

        const initializeAudio = async () => {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                window.speechSynthesis.getVoices();
            }
            return Promise.resolve();
        };

        const playText = (text) => {
            return new Promise((resolve) => {
                if (!('speechSynthesis' in window)) { resolve(); return; }
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(text);
                u.lang = 'zh-CN'; u.rate = 0.8; u.pitch = 1.0;
                const v = window.speechSynthesis.getVoices().find(v => v.lang.includes('zh'));
                if (v) u.voice = v;
                u.onend = () => resolve();
                u.onerror = () => resolve();
                window.speechSynthesis.speak(u);
            });
        };

        // --- APP LOGIC ---
        const App = () => {
            const [gameState, setGameState] = useState('PLAYING');
            const [inputText, setInputText] = useState(DEFAULT_DATA);
            const [learnedText, setLearnedText] = useState("");
            const [wordList, setWordList] = useState([]);
            const [wordStats, setWordStats] = useState({});
            const [score, setScore] = useState(0);
            const [currentOptions, setCurrentOptions] = useState([]);
            const [targetWord, setTargetWord] = useState(null);
            const [isPlayingAudio, setIsPlayingAudio] = useState(false);
            const [feedback, setFeedback] = useState('none');
            const [errorMessage, setErrorMessage] = useState(null);
            const [masteryNotification, setMasteryNotification] = useState(null);
            const [scoreBump, setScoreBump] = useState(false);
            const [showCelebration, setShowCelebration] = useState(false);
            const [dailyGoal, setDailyGoal] = useState(10);
            const [dailyProgress, setDailyProgress] = useState(0);
            const [streak, setStreak] = useState(0);
            const [goalMetToday, setGoalMetToday] = useState(false);
            
            const isMounted = useRef(true);
            const wordListRef = useRef([]);
            const fileInputRef = useRef(null);

            const parseInputData = (text) => {
                if (!text) return [];
                return text.split('\n').map((line, index) => {
                    const parts = line.split(/[:ï¼š]/);
                    if (parts.length >= 2) return { id: `w-${index}`, char: parts[0].trim(), word: parts[1].trim() };
                    return null;
                }).filter(x => x && x.char.length > 0);
            };

            useEffect(() => { wordListRef.current = wordList; }, [wordList]);
            useEffect(() => { return () => { isMounted.current = false; }; }, []);

            useEffect(() => {
                initializeAudio();
                const savedGoal = localStorage.getItem('ww_goal');
                if (savedGoal) setDailyGoal(parseInt(savedGoal));
                
                const savedScore = parseInt(localStorage.getItem('ww_score') || '0');
                setScore(savedScore);

                const lastDate = localStorage.getItem('ww_date');
                const today = new Date().toDateString();
                const savedStreak = parseInt(localStorage.getItem('ww_streak') || '0');
                const savedProg = parseInt(localStorage.getItem('ww_prog') || '0');
                const savedMet = localStorage.getItem('ww_met') === 'true';

                if (lastDate === today) {
                    setDailyProgress(savedProg);
                    setStreak(savedStreak);
                    setGoalMetToday(savedMet);
                } else {
                    setDailyProgress(0);
                    setGoalMetToday(false);
                    localStorage.setItem('ww_prog', '0');
                    localStorage.setItem('ww_met', 'false');
                    localStorage.setItem('ww_date', today);
                    if (lastDate) {
                        const d1 = new Date(lastDate);
                        const diff = Math.ceil(Math.abs(new Date().getTime() - d1.getTime()) / (86400000));
                        if (diff > 1 && !savedMet) {
                            setStreak(0); localStorage.setItem('ww_streak', '0');
                        } else {
                            setStreak(savedStreak);
                        }
                    } else setStreak(0);
                }

                try {
                    const s = localStorage.getItem('ww_stats');
                    if (s) setWordStats(JSON.parse(s));
                } catch(e){}

                const si = localStorage.getItem('ww_input');
                const sl = localStorage.getItem('ww_learned');
                const curIn = si !== null ? si : DEFAULT_DATA;
                setInputText(curIn);
                setWordList(parseInputData(curIn));
                if (sl) setLearnedText(sl);
            }, []);

            const updateProgress = () => {
                const np = dailyProgress + 1;
                setDailyProgress(np);
                localStorage.setItem('ww_prog', np);
                localStorage.setItem('ww_date', new Date().toDateString());
                if (np >= dailyGoal && !goalMetToday) {
                    const ns = streak + 1;
                    setStreak(ns);
                    setGoalMetToday(true);
                    localStorage.setItem('ww_streak', ns);
                    localStorage.setItem('ww_met', 'true');
                    setShowCelebration(true);
                    playCelebrationSound();
                    setTimeout(() => isMounted.current && setShowCelebration(false), 5000);
                }
            };

            const setupRound = useCallback(() => {
                const list = wordListRef.current;
                if (list.length === 0) { setTargetWord(null); return; }

                const items = list.map(item => {
                    const s = wordStats[item.char] || { correct: 0, incorrect: 0 };
                    const w = 10 * (1 + s.incorrect * 3) / (1 + s.correct * 0.5);
                    return { item, w };
                });

                let tw = items.reduce((sum, x) => sum + x.w, 0);
                let rnd = Math.random() * tw;
                let target = list[0];
                for (const en of items) {
                    rnd -= en.w;
                    if (rnd <= 0) { target = en.item; break; }
                }

                setTargetWord(target);
                
                const others = list.filter(w => w.char !== target.char).sort(() => 0.5 - Math.random());
                const distractors = [];
                const used = new Set();
                for (const d of others) {
                    if (!used.has(d.char)) { distractors.push(d); used.add(d.char); }
                    if (distractors.length >= 2) break;
                }
                while(distractors.length < 2 && list.length >= 3) {
                     const r = list[Math.floor(Math.random()*list.length)];
                     if(r.char!==target.char && !used.has(r.char)) { distractors.push(r); used.add(r.char); }
                     if(distractors.length>=2) break;
                }
                setCurrentOptions([target, ...distractors].sort(() => 0.5 - Math.random()));
                setFeedback('none');
                setTimeout(() => playTargetAudio(target), 500);
            }, [wordStats]);

            useEffect(() => {
                if (gameState === 'PLAYING' && wordList.length > 0 && !targetWord) setupRound();
            }, [gameState, wordList, setupRound, targetWord]);

            const playTargetAudio = async (w) => {
                if (!w || isPlayingAudio) return;
                setErrorMessage(null);
                setIsPlayingAudio(true);
                await playText(`${w.char}ï¼Œ${w.word}`);
                if (isMounted.current) setIsPlayingAudio(false);
            };

            const handleOptionClick = async (sel) => {
                if (!targetWord || isPlayingAudio || feedback === 'correct') return;
                if (sel.id === targetWord.id) {
                    setFeedback('correct');
                    playCorrectSound();
                    setScoreBump(true);
                    setTimeout(() => setScoreBump(false), 400);
                    setScore(s => { localStorage.setItem('ww_score', s+1); return s+1; });
                    updateProgress();

                    let mastered = false;
                    setWordStats(prev => {
                        const s = prev[targetWord.char] || {correct:0,incorrect:0,consecutiveCorrect:0};
                        const nc = (s.consecutiveCorrect||0) + 1;
                        if (nc >= 20) mastered = true;
                        const ns = {...prev, [targetWord.char]: {...s, correct: s.correct+1, consecutiveCorrect: nc}};
                        localStorage.setItem('ww_stats', JSON.stringify(ns));
                        return ns;
                    });

                    if (mastered) {
                        setTimeout(() => {
                            setMasteryNotification(`å¤ªæ£’äº†ï¼"${targetWord.char}" å·²ç»å­¦ä¼šï¼`);
                            setTimeout(() => setMasteryNotification(null), 4000);
                            const lines = inputText.split('\n');
                            const idx = lines.findIndex(l => l.split(/[:ï¼š]/)[0]?.trim() === targetWord.char);
                            if (idx !== -1) {
                                const line = lines[idx];
                                lines.splice(idx, 1);
                                const nIn = lines.join('\n');
                                const nLe = (learnedText ? learnedText+'\n':'') + line;
                                setInputText(nIn); setLearnedText(nLe);
                                localStorage.setItem('ww_input', nIn); localStorage.setItem('ww_learned', nLe);
                                setWordList(parseInputData(nIn));
                            }
                        }, 1000);
                    }

                    setTimeout(async () => {
                        await playText(PRAISE_PHRASES[Math.floor(Math.random()*PRAISE_PHRASES.length)]);
                        setTimeout(() => isMounted.current && setupRound(), 500);
                    }, 300);
                } else {
                    setFeedback('incorrect');
                    setWordStats(prev => {
                        const s = prev[targetWord.char] || {correct:0,incorrect:0,consecutiveCorrect:0};
                        const ns = {...prev, [targetWord.char]: {...s, incorrect: s.incorrect+1, consecutiveCorrect: 0}};
                        localStorage.setItem('ww_stats', JSON.stringify(ns));
                        return ns;
                    });
                    setTimeout(() => {
                        if (isMounted.current) { setFeedback('none'); playTargetAudio(targetWord); }
                    }, 800);
                }
            };

            const handleExport = () => {
                const d = { input: inputText, learned: learnedText, stats: wordStats, score, streak, goal: dailyGoal, prog: dailyProgress, date: localStorage.getItem('ww_date'), met: localStorage.getItem('ww_met') };
                const b = new Blob([JSON.stringify({version:1, data:d})], {type:'application/json'});
                const u = URL.createObjectURL(b);
                const a = document.createElement('a'); a.href=u; a.download='renzi-backup.json';
                document.body.appendChild(a); a.click(); document.body.removeChild(a);
            };

            const handleImport = (e) => {
                const f = e.target.files?.[0];
                if (!f) return;
                const r = new FileReader();
                r.onload = (ev) => {
                    try {
                        const d = JSON.parse(ev.target.result).data;
                        if(d.input) localStorage.setItem('ww_input', d.input);
                        if(d.learned) localStorage.setItem('ww_learned', d.learned);
                        if(d.stats) localStorage.setItem('ww_stats', JSON.stringify(d.stats));
                        localStorage.setItem('ww_score', d.score||0);
                        localStorage.setItem('ww_streak', d.streak||0);
                        localStorage.setItem('ww_goal', d.goal||10);
                        localStorage.setItem('ww_prog', d.prog||0);
                        window.location.reload(); 
                    } catch(err){ alert("å¯¼å…¥å¤±è´¥"); }
                };
                r.readAsText(f);
            };

            const renderContent = () => {
                if (gameState === 'SETUP') {
                    return (
                        <div className="max-w-4xl w-full bg-white rounded-3xl shadow-xl p-8 animate-fade-in">
                            <div className="flex justify-center mb-6 text-indigo-600"><Icons.Settings size={48}/></div>
                            <h1 className="text-3xl font-bold text-center mb-6">è®¾ç½®å†…å®¹</h1>
                            <div className="grid md:grid-cols-2 gap-8 mb-8">
                                <div className="flex flex-col gap-6">
                                    <div>
                                        <label className="flex items-center gap-2 font-bold mb-2 text-gray-700"><Icons.Flame className="text-orange-500" size={18}/> æ¯æ—¥ç›®æ ‡</label>
                                        <div className="bg-indigo-50 p-4 rounded-xl border border-indigo-100 flex items-center gap-4">
                                            <input type="number" min="1" value={dailyGoal} onChange={e=>setDailyGoal(parseInt(e.target.value)||1)} className="w-20 p-2 text-center text-xl font-bold rounded-lg"/>
                                            <span className="text-gray-600">å­— / å¤©</span>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="flex items-center gap-2 font-bold mb-2 text-gray-700"><Icons.Save className="text-blue-500" size={18}/> æ•°æ®ç®¡ç†</label>
                                        <div className="bg-blue-50 p-4 rounded-xl flex gap-4">
                                            <button onClick={handleExport} className="flex-1 bg-white text-blue-600 py-3 rounded-lg font-bold flex justify-center gap-2 shadow-sm"><Icons.Download size={18}/>å¤‡ä»½</button>
                                            <button onClick={()=>fileInputRef.current.click()} className="flex-1 bg-blue-500 text-white py-3 rounded-lg font-bold flex justify-center gap-2 shadow-md"><Icons.Upload size={18}/>æ¢å¤</button>
                                            <input type="file" ref={fileInputRef} onChange={handleImport} className="hidden" accept=".json"/>
                                        </div>
                                    </div>
                                </div>
                                <div className="flex flex-col gap-6">
                                    <div><label className="flex gap-2 font-bold mb-2 text-gray-700"><Icons.Play size={16}/> å­¦ä¹ ç´ æ</label><textarea className="w-full h-32 p-4 bg-indigo-50 border-2 border-indigo-100 rounded-xl" value={inputText} onChange={e=>setInputText(e.target.value)}/></div>
                                    <div><label className="flex gap-2 font-bold mb-2 text-gray-700"><Icons.GraduationCap size={16}/> å·²å­¦ä¼š</label><textarea className="w-full h-32 p-4 bg-green-50 border-2 border-green-100 rounded-xl" value={learnedText} onChange={e=>setLearnedText(e.target.value)}/></div>
                                </div>
                            </div>
                            <button onClick={async ()=>{ 
                                await initializeAudio(); 
                                if(parseInputData(inputText).length<3) { alert("è¯·è‡³å°‘è¾“å…¥3è¡Œç´ æ"); return; }
                                localStorage.setItem('ww_input', inputText);
                                localStorage.setItem('ww_learned', learnedText);
                                localStorage.setItem('ww_goal', dailyGoal);
                                setWordList(parseInputData(inputText));
                                setGameState('PLAYING');
                            }} className="w-full bg-indigo-500 text-white font-bold py-4 rounded-xl text-xl shadow-lg flex justify-center gap-2"><Icons.Play size={24}/> å¼€å§‹å­¦ä¹ </button>
                        </div>
                    );
                }

                if (wordList.length === 0) {
                     return <div className="max-w-lg w-full bg-white rounded-3xl p-8 text-center shadow-xl"><Icons.Trophy size={80} className="text-yellow-500 mx-auto mb-6"/><h2 className="text-2xl font-bold mb-4">æ­å–œä½ ï¼</h2><p className="mb-8">å­¦ä¼šäº†æ‰€æœ‰å­—ï¼</p><button onClick={()=>setGameState('SETUP')} className="bg-indigo-500 text-white font-bold py-3 px-8 rounded-xl">æ·»åŠ ç´ æ</button></div>;
                }

                return (
                    <div className="max-w-lg w-full flex flex-col items-center">
                        <div className="w-full flex flex-col gap-4 mb-6 px-4">
                            <div className="flex justify-between items-center">
                                <button onClick={()=>setGameState('SETUP')} className="p-2 bg-white rounded-full shadow-sm text-gray-400"><Icons.Settings size={20}/></button>
                                <div className={`flex items-center gap-2 px-4 py-2 rounded-full border-2 ${goalMetToday?'bg-orange-50 border-orange-200 text-orange-600':'bg-gray-50 border-gray-100 text-gray-400'}`}><Icons.Flame size={24} fill={goalMetToday?"currentColor":"none"}/><div className="flex flex-col leading-none"><span className="text-lg font-black">{streak}</span><span className="text-[10px]">å¤©è¿å‡»</span></div></div>
                                <div className={`flex items-center gap-2 bg-yellow-100 px-4 py-2 rounded-full border-2 border-yellow-200 ${scoreBump?'animate-score-bump':''}`}><Icons.Trophy size={20} className="text-yellow-500" fill="currentColor"/><span className="text-xl font-bold text-yellow-700">{score}</span></div>
                            </div>
                            <div className="w-full bg-white p-3 rounded-2xl shadow-sm border border-gray-100"><div className="flex justify-between text-xs font-bold mb-1 px-1"><span>ä»Šæ—¥æŒ‘æˆ˜</span><span>{dailyProgress} / {dailyGoal}</span></div><div className="w-full h-3 bg-gray-100 rounded-full overflow-hidden"><div className={`h-full transition-all duration-1000 rounded-full ${goalMetToday?'bg-gradient-to-r from-orange-400 to-red-500':'bg-indigo-400'}`} style={{width:`${Math.min(100,(dailyProgress/dailyGoal)*100)}%`}}></div></div></div>
                        </div>
                        <div className="w-full bg-white rounded-3xl shadow-2xl p-6 mb-8 relative overflow-hidden min-h-[500px] flex flex-col justify-start border-b-8 border-indigo-100">
                            {masteryNotification && <div className="absolute inset-x-0 top-0 bg-green-100 p-3 text-green-700 text-sm font-bold text-center flex justify-center gap-2 z-20 animate-pop-in"><Icons.CheckCircle size={18}/>{masteryNotification}</div>}
                            <div className="text-center mb-6 mt-2 shrink-0">
                                <button onClick={()=>targetWord&&playTargetAudio(targetWord)} disabled={isPlayingAudio} className={`w-20 h-20 rounded-full flex items-center justify-center mx-auto transition-transform active:scale-95 ${isPlayingAudio?'bg-indigo-100 text-indigo-500 ring-4 ring-indigo-200':'bg-indigo-500 text-white shadow-lg'}`}>{isPlayingAudio?<div className="flex gap-1 items-end h-8 pb-2"><span className="w-1.5 h-3 bg-current rounded-full animate-bounce"></span><span className="w-1.5 h-5 bg-current rounded-full animate-bounce"></span><span className="w-1.5 h-3 bg-current rounded-full animate-bounce"></span></div>:<Icons.Volume2 size={36}/>}</button>
                            </div>
                            <div className="h-8 text-center mb-4 shrink-0">{feedback==='correct'&&<span className="text-green-500 font-bold text-2xl animate-bounce block">ä½ çœŸæ£’ï¼ğŸ‰</span>}</div>
                            <div className="grid grid-cols-3 gap-3 md:gap-4 flex-grow content-center">
                                {currentOptions.map(opt => {
                                    const isTarget = targetWord?.id===opt.id;
                                    return (
                                        <button key={opt.id} onClick={()=>handleOptionClick(opt)} disabled={isPlayingAudio||feedback==='correct'} className={`w-full aspect-[4/5] md:aspect-square rounded-2xl text-7xl md:text-8xl font-bold transition-all shadow-md flex items-center justify-center relative ${feedback==='correct'&&isTarget?'bg-green-500 text-white ring-4 ring-green-200 z-10 scale-105':'bg-white hover:bg-indigo-50 border-2 border-gray-100 text-gray-800'}`}>{opt.char}</button>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen w-full bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4 font-sans relative">
                    {renderContent()}
                    {showCelebration && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-fade-in" onClick={()=>setShowCelebration(false)}>
                            <div className="relative w-full max-w-sm mx-4 bg-white rounded-3xl p-8 text-center shadow-2xl animate-pop-in border-4 border-yellow-300" onClick={e=>e.stopPropagation()}>
                                <button onClick={()=>setShowCelebration(false)} className="absolute top-4 right-4 text-gray-400"><Icons.X/></button>
                                <div className="flex justify-center mb-6"><div className="relative"><Icons.Flame size={80} className="text-orange-500 animate-bounce" fill="currentColor"/><Icons.Star size={30} className="text-yellow-400 absolute -top-2 -right-4 animate-spin" fill="currentColor"/></div></div>
                                <h2 className="text-3xl font-black text-orange-600 mb-2">æŒ‘æˆ˜æˆåŠŸï¼</h2>
                                <p className="text-gray-600 text-lg mb-6">ä»Šæ—¥ç›®æ ‡å·²è¾¾æˆ</p>
                                <button onClick={()=>setShowCelebration(false)} className="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold py-3 rounded-xl shadow-lg">ç»§ç»­åŠ æ²¹</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>